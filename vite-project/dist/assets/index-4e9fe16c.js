(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerpolicy&&(n.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?n.credentials="include":l.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=r(l);fetch(l.href,n)}})();function h(e){return Math.floor(e-273.15)}function D(e){return["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"][e]}function x(e){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e]}function d(e,t,r,s){let l=document.createElement(e),n=document.createTextNode(t);l.appendChild(n),r.appendChild(l),l.classList.add(s)}function N(e){let t,r=["./assets/svg/cloud.svg","./assets/svg/drizzle.svg","./assets/svg/rain.svg","./assets/svg/sun.svg","./assets/svg/suncloud.svg","./assets/svg/snow.svg"];switch(e){case"Rain":t=r[2];break;case"Clouds":t=r[0];break;case"Snow":t=r[5];break;case"Clear":t=r[3];break}return t}class _{constructor(t,r,s,l,n,a,m,f,p,y,w){this.fullDate=`${x(t.getDay())} ${t.getDate()} ${D(t.getMonth())} ${t.getFullYear()}`,this.time=` ${t.getHours()<=10?`0${t.getHours()}`:`${t.getHours()}`}:${t.getMinutes()<=10?`0${t.getMinutes()}`:`${t.getMinutes()}`}`,this.temp=`${r}°C`,this.min=`${s}°C`,this.max=`${l}°C`,this.feels=`${n}°C`,this.humidity=`${a}%`,this.pressure=`${m} hPa`,this.wind=`${f}m/s`,this.winddir=p,this.clouds=`${y}%`,this.cloudy=`${N(w)}`}}let $=document.querySelector("header");function g(){d("label","Enter a city name",$,"townToCheckLabel"),d("input","",$,"townToCheck"),d("button","Get weather forecasts",$,"forecast__Button");let e=document.querySelector(".forecast__Button");e.setAttribute("aria-label","get new weather forecast");let t=document.querySelector(".townToCheck");t.setAttribute("id","townToCheck"),document.querySelector(".townToCheckLabel").setAttribute("for","townToCheck");let s;t.addEventListener("keyup",l=>{s=l.target.value,l.code=="Enter"&&(v(s),g())}),e.addEventListener("click",()=>{v(s),g()})}async function v(e){let r=await(await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${e}&APPID=77cf7509f6657d267e637e6c2a540ddf`)).json();I(r),console.log("requête envoyée"),localStorage.setItem("meteo",e),localStorage.setItem("meteostored",JSON.stringify(r))}let B=localStorage.getItem("meteostored"),F=JSON.parse(B),C=localStorage.getItem("meteo");const M=[],S=[],L=[],T=[],E=[];window.addEventListener("load",()=>{C!==null&&I(F),C===null&&g()});let b=document.querySelector("header"),k=document.querySelector("main");function I(e){b.innerHTML="",k.innerHTML="";let t=e.city.name,r=e.city.country;d("h1",`${t}`,b,"ville"),d("div",`${r}`,b,"pays"),g();for(let s=0;s<e.list.length;s++){let l=new Date(e.list[s].dt_txt),n=h(e.list[s].main.temp),a=h(e.list[s].main.feels_like),m=h(e.list[s].main.temp_min),f=h(e.list[s].main.temp_max),p=e.list[s].main.humidity,y=e.list[s].main.pressure,w=e.list[s].wind.speed,q=e.list[s].wind.deg,O=e.list[s].clouds.all,A=e.list[s].weather[0].main,i=new _(l,n,m,f,a,p,y,w,q,O,A);M.push(n),E.push(a),L.push(m),T.push(f),S.push(`${i.fullDate} - ${i.time}`);let u=document.createElement("article");u.setAttribute("id",`weatherLine-${s}`),k.appendChild(u);for(let o in i)if(o=="cloudy"){d("img","",u,`images-${s}`);let c=document.querySelector(`.images-${s}`);c.classList.add("image-weather"),c.setAttribute("alt",`${o} ${i[o]}`),c.src=i.cloudy}else if(o=="winddir"){d("img","",u,`images-wind-${s}`);let c=document.querySelector(`.images-wind-${s}`);c.classList.add("image-wind"),c.src="./assets/svg/arrow.svg",c.setAttribute("alt",`${o} ${i[o]}`),c.style.transform=`rotate(${0+i.winddir}deg)`}else d("div",`${i[o]}`,u,o)}}document.getElementById("darkMode").addEventListener("click",()=>{document.documentElement.classList.toggle("dark-mode")});let H=document.getElementById("cadre");const J=H.getContext("2d");new Chart(J,{type:"line",data:{labels:S,datasets:[{label:"Température",data:M,fill:!1,borderColor:"rgba(0,0,0,0.5)",tension:.1},{label:"Température ressentie",data:E,fill:!1,borderColor:"#54b5ce8f",tension:.1},{label:"Température minimales",data:L,fill:!1,borderColor:"rgba(98, 83, 201, 0.56)",tension:.1},{label:"Température minimales",data:T,fill:!1,borderColor:"rgba(217, 113, 38, 0.56)",tension:.1}]}});
